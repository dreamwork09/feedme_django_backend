/*! Feedmee Pty Ltd 2017-06-29 */

!function e(t,r,o){function a(n,s){if(!r[n]){if(!t[n]){var l="function"==typeof require&&require;if(!s&&l)return l(n,!0);if(i)return i(n,!0);var d=new Error("Cannot find module '"+n+"'");throw d.code="MODULE_NOT_FOUND",d}var c=r[n]={exports:{}};t[n][0].call(c.exports,function(e){var r=t[n][1][e];return a(r||e)},c,c.exports,e,t,r,o)}return r[n].exports}for(var i="function"==typeof require&&require,n=0;n<o.length;n++)a(o[n]);return a}({1:[function(e,t,r){FormModal=e("./modules/formModal.js").FormModal,DE={init:function(){this.FormModal=new FormModal},pageManagers:{Restaurant:e("./modules/pagemanagers/restaurant.js").Restaurant,Blog:e("./modules/pagemanagers/blog.js").Blog,Dish:e("./modules/pagemanagers/dish.js").Dish}}},{"./modules/formModal.js":3,"./modules/pagemanagers/blog.js":5,"./modules/pagemanagers/dish.js":6,"./modules/pagemanagers/restaurant.js":7}],2:[function(e,t,r){"use strict";r.__esModule=!0;var o=function(){function e(){var e=this;this.formSelector="form.async-managed",this.callbackRegister={},this.handleSubmit=function(t){t.preventDefault();var r=$(event.target).closest("form"),o=r.attr("action");$.ajax({url:o,data:r.serializeArray(),type:r.attr("method")}).done(function(e){return r.replaceWith(e)}).done(function(){return e.runCallbacks(o)})},this.runCallbacks=function(t){try{var r=e.callbackRegister[t];if(void 0!==r)for(var o=0;o<r.length;o++)try{r[o]()}catch(e){console.error(e)}}catch(e){console.error(e)}},$("body").on("submit",this.formSelector,this.handleSubmit)}return e.prototype.registerCallback=function(e,t){void 0!==this.callbackRegister[e]?this.callbackRegister[e].push(t):this.callbackRegister[e]=[t]},e}();r.FormManager=o},{}],3:[function(e,t,r){"use strict";r.__esModule=!0;var o=function(){function e(e){var t=this;this.element=$("<div id='FormModal' style='display:none;'><div class='pull-right' id='modal-x'>X</div><div id='modal-body'></div></div>"),this.background=$("<div id='bg-overlay' style='display:none;'></div>"),this.open=!1,this.clickSelector='a[data-modal-open="form"]',this.toggleModal=function(e){e.preventDefault(),e.stopPropagation();var r=$(e.target).closest(t.clickSelector).data("formUrl");t.open?t.hideModal():t.loadForm(r)},this.showModal=function(){t.open=!0,t.background.fadeIn(300),t.element.show(300)},this.hideModal=function(){t.open=!1,t.background.fadeOut(300),t.element.hide(300)},this.submit=function(e){e.preventDefault(),$.ajax({url:t.form.attr("action"),data:t.form.serializeArray(),type:t.form.attr("method")}).done(function(e){return t.modalBody.html(e)}).done(function(e){return t.activeForm.success(e)}).fail(function(){return t.activeForm.failure()})},void 0!==e&&(void 0!==e.element&&(this.element=e.element),void 0!==e.clickSelector&&(this.clickSelector=e.clickSelector)),this.modalBody=this.element.find("#modal-body"),$("body").append(this.element),$("body").append(this.background),$("body").on("click",this.clickSelector,this.toggleModal),this.background.click(this.hideModal),$("#modal-x",this.element).click(this.hideModal),this.element.on("submit","form",this.submit)}return e.prototype.loadForm=function(e){var t=this;this.modalBody.load(e,function(){t.form=t.element.find("form"),t.showModal()})},e}();r.FormModal=o},{}],4:[function(e,t,r){"use strict";r.__esModule=!0;var o=function(){return function(e){var t=this;this.delClickSelector=".formset-delete-btn",this.delCheckWrapperSelector=".formset-delete-cx",this.addClickSelector=".formset-add-btn",this.deleteForm=function(e){e.preventDefault(),e.stopPropagation();var r=$(e.target);r.siblings(t.delCheckWrapperSelector).find("input").click(),r.closest(".row").hide(300)},this.addForm=function(e){e.preventDefault(),e.stopPropagation();var t=$(event.target),r=t.data("formName"),o=t.closest("form"),a=$("#id_"+r+"-TOTAL_FORMS",o),i=$("#empty-form",o),n=a.val();$(".formset-rows",o).append(i.html().replace(/__prefix__/g,n)),a.val(parseInt(n)+1)},void 0!==e&&(void 0!==e.delClickSelector&&(this.delClickSelector=e.delClickSelector),void 0!==e.delCheckWrapperSelector&&(this.delCheckWrapperSelector=e.delCheckWrapperSelector)),$("body").on("click",this.delClickSelector,this.deleteForm),$("body").on("click",this.addClickSelector,this.addForm)}}();r.FormsetManager=o},{}],5:[function(e,t,r){"use strict";r.__esModule=!0;var o=e("./../FormManager"),a=function(){return function(){this.formManager=new o.FormManager}}();r.Blog=a},{"./../FormManager":2}],6:[function(e,t,r){"use strict";r.__esModule=!0;var o=e("./../FormManager"),a=function(){return function(){this.formManager=new o.FormManager}}();r.Dish=a},{"./../FormManager":2}],7:[function(e,t,r){"use strict";r.__esModule=!0;var o=e("./../formsetManager"),a=e("./../FormManager"),i=function(){return function(){var e=this;this.timers={},this.geocodeAddress=function(){e.tzInput.prop("disabled",!0),e.suburbInput.prop("disabled",!0),void 0!==e.timers.addr&&clearTimeout(e.timers.addr),e.timers.addr=setTimeout(function(){$.getJSON("/api/geocode/?address="+e.addrInput.val(),function(t){e.suburbInput.val(t.suburb),e.suburbInput.prop("disabled",!1),e.latitudeInput.val(t.latitude),e.longitudeInput.val(t.longitude),$.getJSON("/api/geocode/?coords="+t.latitude+","+t.longitude+"&return=timezone",function(t){e.tzInput.val(t.timeZoneId),e.offsetMinutesInput.val(t.rawOffset/60),e.tzInput.prop("disabled",!1)})})},1e3)},this.addrInput=$("#id_address"),this.tzInput=$("#id_timezone"),this.offsetMinutesInput=$("#id_time_offset_minutes"),this.suburbInput=$("#id_suburb"),this.latitudeInput=$("#id_latitude"),this.longitudeInput=$("#id_longitude"),this.addrInput.on("input",this.geocodeAddress),this.formset=new o.FormsetManager,this.formManager=new a.FormManager,this.formManager.registerCallback("/data-entry/forms/restaurants/",function(){var e=$('input[name="id"]',"#restaurant-form").val();e>0&&window.location.pathname!=="/data-entry/restaurants/"+e+"/change/"&&window.location.assign("/data-entry/restaurants/"+e+"/change/")}),this.formManager.registerCallback("/data-entry/forms/blogs/",function(){$("#existing-blogs").load(window.location.pathname+" #existing-blogs")}),this.formManager.registerCallback("/data-entry/forms/dishes/",function(){$("#existing-dishes").load(window.location.pathname+" #existing-dishes")}),this.formManager.registerCallback("/data-entry/forms/recipes/",function(){$("#existing-recipes").load(window.location.pathname+" #existing-recipes")})}}();r.Restaurant=i},{"./../FormManager":2,"./../formsetManager":4}]},{},[1]);
//# sourceMappingURL=dataEntry.min.js.map